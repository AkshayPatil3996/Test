{% extends 'base.html' %}
{% load static %}
{% block title %} Miscellaneous{% endblock title %}
{% block main-content %}

<h4 class="py-3 mb-4">
    <span class="text-muted fw-light">Miscellaneous/</span> Miscellaneous
</h4>


<div class="container mt-3">
    <div class="row">
        <!-- Form Column for Job Skills -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <form method="POST" id="jobSkillForm">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <h5 class="card-header">Create Job Skill</h5>
                                <div class="d-flex">
                                    <input type="text" id="jsm_skill" name="jsm_skill" class="form-control" placeholder="Enter your Job Skill here..." required>
                                    <button type="submit" style="margin-left: 15px;" class="btn btn-primary waves-effect waves-light" id="jobSkillAction" >Submit</button>
                                </div>
                                <div class="card-body mt-3" style="height: 200px; overflow-y: scroll;">
                                    <div class="card bg-label-primary mb-2" id="jobSkill_{{ skill.id }}">
                                        <div class="card-body d-flex justify-content-between align-items-center">
                                            {% for skill in job_skills %}
                                                <div class="card bg-label-primary mb-2" id="jobSkill_{{ skill.id }}">
                                                    <div class="card-body d-flex justify-content-between align-items-center">
                                                        <h4 class="mb-0">{{ forloop.counter }}. {{ skill.jsm_skill }}</h4>
                                                        <div class="d-flex" style="font-size: 1.25rem;">
                                                            <i class="fa-regular fa-pen-to-square" 
                                                            style="cursor: pointer; margin-right: 10px; color: rgb(67, 67, 143);"
                                                            data-bs-toggle="modal" 
                                                            data-bs-target="#animationModal"
                                                            onclick="populateModal({{ skill.id }}, '{{ skill.jsm_skill }}', 'job_skill')">
                                                            </i>
                                                            <i class="fa-solid fa-trash" 
                                                            style="cursor: pointer; color: rgb(173, 83, 133); margin-right: 10px;"
                                                            onclick="confirmDelete({{ skill.id }}, 'job_skill')">
                                                            </i>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% empty %}
                                                <p>No Job Skills available yet.</p>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <input type="hidden" name="action" id="jobSkillAction" value="add">
                            </div>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>

        <!-- Form Column for Industry Master -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-body">
                    <form method="POST" id="industryForm">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <h5 class="card-header">Create Industry Master</h5>
                                <div class="d-flex">
                                    <input type="text" id="industry_name" name="industry_name" class="form-control" placeholder="Enter your Industry Master here..." required>
                                    <button type="submit" style="margin-left: 15px;" class="btn btn-primary waves-effect waves-light" id="submitIndustryBtn">Submit</button>
                                </div>
                                <div class="card-body mt-3" style="height: 200px; overflow-y: scroll;">
                                    <div class="card bg-label-primary mb-2" id="industry_{{ industry.id }}">
                                        <div class="card-body d-flex justify-content-between align-items-center">
                                            {% for industry in industries %}
                                                <div class="card bg-label-primary mb-2" id="industry_{{ industry.id }}">
                                                    <div class="card-body d-flex justify-content-between align-items-center">
                                                        <h4 class="mb-0">{{ forloop.counter }}. {{ industry.name }}</h4>
                                                        <div class="d-flex" style="font-size: 1.25rem;">
                                                            <i class="fa-regular fa-pen-to-square" 
                                                            style="cursor: pointer; margin-right: 10px; color: rgb(67, 67, 143);"
                                                            data-bs-toggle="modal" 
                                                            data-bs-target="#animationModal"
                                                            onclick="populateModal({{ industry.id }}, '{{ industry.name }}', 'industry')">
                                                            </i>
                                                            <i class="fa-solid fa-trash" 
                                                            style="cursor: pointer; color: rgb(173, 83, 133); margin-right: 10px;"
                                                            onclick="confirmDelete({{ industry.id }}, 'industry')">
                                                            </i>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% empty %}
                                                <p>No Industries available yet.</p>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <input type="hidden" name="action" id="industryAction" value="add">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Add/Update Job Skill or Industry -->
<div class="modal fade" id="animationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="modalTitle" class="modal-title">Add/Edit Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="modalTitleInput" class="form-control" placeholder="Enter name" required>
                <input type="hidden" id="currentItemId">
                <input type="hidden" id="formAction" value="add_job_skill"> <!-- Default action is 'add_job_skill' -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveChangesBtn">Save changes</button>
            </div>
        </div>
    </div>
</div>


{% endblock main-content %}

{% block javascript %}

<script>
    $('#jobSkillForm').submit(function(e) {
        e.preventDefault(); 

        const action = $('#jobSkillAction').val();
        const name = $('#jsm_skill').val();

        const csrfToken = '{{ csrf_token }}';

        let postData = {
            csrfmiddlewaretoken: csrfToken,
            action: action,
            jsm_skill: name
        };

        console.log(postData);

        $.post('miscellaneous', postData, function(response) {
            if (response.status === 'success') {
                Swal.fire('Success', response.message, 'success');
                location.reload(); 
            } else {
                Swal.fire('Error', 'Something went wrong, please try again later.', 'error');
            }
        });
    });

 
    $('#industryForm').submit(function(e) {
        e.preventDefault();  

        const action = $('#industryAction').val();
        const name = $('#industry_name').val();
        const csrfmiddlewaretoken = '{{ csrf_token }}';

        let postData = {
            csrfmiddlewaretoken: csrfToken,
            action: action,
            industry_name: name
        };

        $.post('miscellaneous', postData, function(response) {
            if (response.status === 'success') {
                Swal.fire('Success', response.message, 'success');
                location.reload(); 
            } else {
                Swal.fire('Error', 'Something went wrong, please try again later.', 'error');
            }
        });
    });

    
    function populateModal(id, name, type) {
        $('#modalTitleInput').val(name); 
        $('#formAction').val(`update_${type}`);  
        $('#currentItemId').val(id);  
        $('#modalTitle').text(`Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`);  
    }

    function confirmDelete(id, type) {
        Swal.fire({
            title: 'Are you sure?',
            text: `You are about to delete this ${type.charAt(0).toUpperCase() + type.slice(1)}!`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                $.post('miscellaneous', {
                    action: `delete_${type}`,
                    id: id,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                }, function(response) {
                    if (response.status === 'success') {
                        Swal.fire('Deleted!', `${type.charAt(0).toUpperCase() + type.slice(1)} has been deleted.`, 'success');
                        $('#' + type + '_' + id).remove(); 
                    } else {
                        Swal.fire('Error!', 'Failed to delete the item.', 'error');
                    }
                });
            }
        });
    }
</script>

<!-- 
<script>

let currentskillId = null;

function populateSkillModal(id, skill){
    document.getElementById()
}

</script> -->

{% endblock javascript %}









